<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>메디셜 영양제 체크</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="영양제체크">
<link rel="apple-touch-icon" href="icon.png">
<link rel="icon" type="image/png" href="icon.png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app">
  <!-- Welcome Overlay -->
  <div class="welcome-overlay" id="welcomeOverlay" style="display:none;">
    <div class="welcome-box">
      <div class="welcome-icon">💊</div>
      <div class="welcome-title">MEDITIAL</div>
      <div class="welcome-desc">매일 건강에 한걸음 나아가고<br>적립금도 받아가세요!</div>
      <input type="text" id="nicknameInput" placeholder="이름을 입력하세요 (필수)" maxlength="10" onkeydown="if(event.key==='Enter')saveNickname()">
      <label class="birthday-label" for="birthdayInput">생년월일</label>
      <input type="date" id="birthdayInput" class="birthday-input">
      <button class="welcome-btn" onclick="saveNickname()">시작하기</button>
    </div>
  </div>

  <header class="header">
    <div class="header-top">
      <div class="header-info">
        <h1>MEDITIAL 영양제 체크</h1>
        <span id="nicknameDisplay"></span>
        <div class="date" id="headerDate"></div>
      </div>
      <button class="dark-toggle" id="darkToggle" onclick="toggleDarkMode()" aria-label="다크모드 전환">
        <span id="darkIcon">🌙</span>
      </button>
    </div>
    <div class="header-bottom">
      <div class="header-progress" id="headerProgress"></div>
      <span id="streakBadge"></span>
    </div>
    <div id="savingsTrack"></div>
  </header>

  <div class="notif-banner" id="notifBanner" onclick="requestNotifPermission()">
    알림을 허용하면 복용 시간에 알려드려요. 여기를 클릭하세요.
  </div>

  <div class="tab-content active" id="today">
    <div id="dateNav"></div>
    <div id="todayList"></div>
    <a href="https://meditial.co.kr/" target="_blank" class="cta-btn"><span class="cta-label">다 드셨나요?</span><span class="cta-click">Click!</span></a>
    <div class="guide-section">
      <button class="guide-toggle" onclick="toggleGuide(this)">
        <span>사용법 안내</span>
        <span class="arrow">▼</span>
      </button>
      <div class="guide-body" id="guideBody">
        <div class="guide-step">
          <div class="guide-num">1</div>
          <div class="guide-text"><strong>관리</strong> 탭에서 <strong>+ 영양제 추가</strong> 버튼을 눌러<br>내가 먹는 영양제를 등록해요.</div>
        </div>
        <div class="guide-step">
          <div class="guide-num">2</div>
          <div class="guide-text"><strong>오늘</strong> 탭에서 영양제를 먹을 때마다<br>동그란 버튼을 눌러 체크해요.</div>
        </div>
        <div class="guide-step">
          <div class="guide-num">3</div>
          <div class="guide-text"><strong>통계</strong> 탭에서 내 복용 기록과<br>캘린더를 한눈에 확인할 수 있어요.</div>
        </div>
        <div class="guide-step">
          <div class="guide-num">4</div>
          <div class="guide-text">복용 체크를 하면 재고가 <strong>자동으로 감소</strong>해요.<br>재고가 3일분 이하가 되면 <strong>빨간색</strong>으로 표시돼요.</div>
        </div>
        <div class="guide-step">
          <div class="guide-num">5</div>
          <div class="guide-text"><strong>앱처럼 사용하기</strong><br>
            아이폰: 사파리 하단 <strong>공유</strong> → <strong>홈 화면에 추가</strong><br>
            안드로이드: 크롬 상단 <strong>메뉴</strong> → <strong>홈 화면에 추가</strong></div>
        </div>
        <div class="guide-step">
          <div class="guide-num">6</div>
          <div class="guide-text"><strong>다크모드 / 라이트모드</strong><br>
            상단 오른쪽 <strong>🌙/☀️ 버튼</strong>을 눌러<br>다크모드와 라이트모드를 전환할 수 있어요.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-content" id="stats">
    <div id="savingsHero"></div>
    <div class="stat-period">
      <button class="period-btn active" data-days="7">최근 7일</button>
      <button class="period-btn" data-days="30">최근 30일</button>
    </div>
    <div class="stat-summary" id="statSummary"></div>
    <div class="chart-section">
      <h3>영양제별 복용률</h3>
      <div id="chartBars"></div>
    </div>
    <div class="calendar-section">
      <h3>복용 캘린더</h3>
      <div id="calendarHeatmap"></div>
    </div>
    <div id="badgeSection"></div>
  </div>

  <div class="tab-content" id="manage">
    <div class="manage-group">
      <h3 class="manage-group-title">내 영양제 관리</h3>
      <button class="add-btn" onclick="openModal()">+ 영양제 추가</button>
      <div id="manageList"></div>
    </div>
    <div class="manage-group">
      <h3 class="manage-group-title">내 정보 관리</h3>
      <div class="nickname-section" id="nicknameSection">
        <div>
          <span class="nickname-label">이름: </span>
          <span class="nickname-value" id="nicknameValue"></span>
        </div>
        <button class="nickname-change-btn" onclick="promptNicknameChange()">변경</button>
      </div>
      <div class="nickname-section" id="birthdaySection">
        <div>
          <span class="nickname-label">생년월일: </span>
          <span class="nickname-value" id="birthdayValue">미설정</span>
        </div>
      </div>
    </div>
    <div class="reset-section">
      <button class="reset-btn" onclick="resetApp()">🔄 앱 초기화</button>
    </div>
  </div>
</div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <button class="nav-item active" data-tab="today">
    <span class="nav-icon">💊</span>
    <span class="nav-label">오늘</span>
  </button>
  <button class="nav-item" data-tab="stats">
    <span class="nav-icon">📊</span>
    <span class="nav-label">통계</span>
  </button>
  <button class="nav-item" data-tab="manage">
    <span class="nav-icon">⚙️</span>
    <span class="nav-label">관리</span>
  </button>
</nav>

<!-- Badge Popup -->
<div class="badge-popup-overlay" id="badgePopup">
  <div class="badge-popup-content">
    <span class="badge-popup-icon" id="badgePopupIcon"></span>
    <div class="badge-popup-title">업적 달성!</div>
    <div class="badge-popup-reward">500원 추가적립!</div>
    <div class="badge-popup-name" id="badgePopupName"></div>
    <div class="badge-popup-desc" id="badgePopupDesc"></div>
    <button class="badge-popup-close" onclick="closeBadgePopup()">확인</button>
  </div>
</div>

<!-- Badge Detail Modal -->
<div class="badge-detail-overlay" id="badgeDetail">
  <div class="badge-detail-content" id="badgeDetailContent">
    <button class="badge-detail-close" onclick="closeBadgeDetail()">✕</button>
    <span class="badge-detail-icon" id="badgeDetailIcon"></span>
    <div class="badge-detail-name" id="badgeDetailName"></div>
    <div class="badge-detail-desc" id="badgeDetailDesc"></div>
    <div class="badge-detail-status" id="badgeDetailStatus"></div>
  </div>
</div>

<!-- Past Complete Prompt -->
<div class="past-prompt-overlay" id="pastPrompt">
  <div class="past-prompt-content">
    <span class="past-prompt-icon">💊</span>
    <div class="past-prompt-text">오늘도 꼭 드실 거죠?</div>
    <button class="past-prompt-yes" onclick="closePastPromptAndGoToday()">YES</button>
  </div>
</div>

<!-- Confetti container -->
<div class="confetti-container" id="confettiContainer"></div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h2 id="modalTitle">영양제 추가</h2>
    <input type="hidden" id="editId">
    <div class="form-group">
      <label>이름</label>
      <select id="inputName" onchange="toggleCustomName()">
        <option value="">-- 선택하세요 --</option>
        <option value="블러드싸이클">블러드싸이클</option>
        <option value="헬리컷">헬리컷</option>
        <option value="판토오틴">판토오틴</option>
        <option value="글루타치온">글루타치온</option>
        <option value="멜라토닌">멜라토닌</option>
        <option value="혈당컷">혈당컷</option>
        <option value="활성엽산">활성엽산</option>
        <option value="상어연골환">상어연골환</option>
        <option value="__custom__">직접 입력</option>
      </select>
      <input type="text" id="inputCustomName" placeholder="영양제 이름을 입력하세요" style="display:none; margin-top:8px;">
    </div>
    <div class="form-group">
      <label>복용 시간</label>
      <input type="time" id="inputTime" value="09:00">
    </div>
    <div class="form-group">
      <label>복용량</label>
      <input type="text" id="inputDose" placeholder="예: 1정">
    </div>
    <div class="form-group">
      <label>재고 수량 (일분)</label>
      <input type="number" id="inputStock" min="0" value="30">
    </div>
    <div class="form-actions">
      <button class="btn-cancel" onclick="closeModal()">취소</button>
      <button class="btn-save" onclick="saveSupplement()">저장</button>
    </div>
  </div>
</div>

<script src="js/data.js"></script>
<script src="js/ui.js"></script>
<script src="js/badges.js"></script>
<script src="js/notifications.js"></script>
<script src="js/today.js"></script>
<script src="js/stats.js"></script>
<script src="js/manage.js"></script>
<script src="js/app.js"></script>
</body>
</html>
